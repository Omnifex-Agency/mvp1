# System Architecture & API Report

**Status:** Live & Functional
**AI Features:** Active (On-Device Transformers.js)
**Current Date:** 2026-01-04
**Extension Version:** 1.0 (Manifest V3)

---

## 1. Technological Stack

We have evolved the architecture to a **fully client-heavy, edge-intelligent** system. This minimizes backend costs and dependency on external API keys (like OpenAI) by running AI directly in the user's browser.

*   **Frontend (Dashboard):** Next.js 16 (React) + Tailwind CSS (Premium "Deep Zinc" Theme) + Framer Motion.
*   **Browser Extension:** Chrome Manifest V3 with **Offscreen Documents** for background execution.
*   **AI Engine:** **Transformers.js** (WebAssembly), running `DistilBART` (Summary) and `Flan-T5` (Quiz) locally.
*   **Backend / Database:** Supabase (PostgreSQL) for storage and syncing.
*   **API Interface:** Supabase REST API via `fetch` standard.

---

## 2. Database Schema (PostgreSQL)

The database remains the central sync point for the extension and dashboard.

### Table: `alerts`

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | `uuid` | Primary Key |
| `user_email` | `text` | Identity (supports anonymous/public for MVP). |
| `title` | `text` | Title generated by AI or page title. |
| `content` | `text` | **The AI-generated output** (Summary points or Quiz questions). |
| `source_url` | `text` | Origin of the capture. |
| `format` | `text` | 'summary' or 'quiz' (Determines dashboard rendering). |
| `reminder_date` | `date` | Scheduled date (Defaults to `Tomorrow`). |
| `status` | `text` | 'scheduled' |

---

## 3. Core Workflows

### A. The "Smart Capture" Workflow (Extension)
**Goal:** Zero-friction knowledge capture.
1.  **Trigger:** User right-clicks text -> Selects **"âœ¨ Smart Capture (Quiz & Summary)"**.
2.  **Background Process (`offscreen.js`):**
    *   The extension spawns a hidden `offscreen.html` worker.
    *   This worker loads **Transformers.js** from CDN (ES Modules).
    *   **Pipeline 1 (Summarization):** Runs `Xenova/distilbart-cnn-6-6` to compress the text.
    *   **Pipeline 2 (Quiz Gen):** Runs `Xenova/LaMini-Flan-T5-783M` to generate a Q&A from the text.
3.  **Storage:** Both results are immediately `POST`ed to Supabase as separate records.
4.  **Feedback:** A premium **Shadow DOM Toast** appears on the webpage confirming success ("Summarized & Quiz Created!").

### B. The Premium Dashboard
**Goal:** Beautiful consumption of captured knowledge.
1.  **No Login Gate:** The dashboard defaults to an "Admin" view, fetching **all** records from Supabase for instant visibility.
2.  **Visualization:**
    *   **List View:** Cards with "Summary" and "Quiz" badges.
    *   **Detail Modal:** A glassmorphic modal overlay.
        *   **Smart Rendering:**
            *   *Summaries* are parsed into clean bullet lists with blue accents.
            *   *Quizzes* are parsed into structured "Question / Option / Answer" blocks with interactive styling.
3.  **Styling:**
    *   **Theme:** "Deep Zinc" (Dark Mode).
    *   **Tech:** Tailwind CSS v4 (@theme configuration) + Custom Scrollbars.

---

## 4. Connection Details

*   **Supabase URL:** `https://ztwcpkaunjtaftvdirqd.supabase.co`
*   **Key:** (Configured in project source)

---

## 5. Recent Achievements
*   **Bypassed Chrome Flags:** Successfully moved from unstable `window.ai` to robust `Transformers.js` (Wasm), ensuring the AI works on any standard Chrome instance without special configuration.
*   **Fixed Styling Issues:** Resolved Tailwind v4 configuration errors (PostCSS), restoring the premium look and feel.
*   **Unified UX:** Simplified the context menu to a single "Do It All" button.

## 6. Next Steps
*   **Email Notifications:** Implement the backend cron job (Supabase Edge Function or external scheduler) to read `due` alerts and email them to the user.
*   **Multi-User Auth:** Re-enable the login gate when ready for public multi-tenant deployment.
