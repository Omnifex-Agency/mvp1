# System Architecture & API Report

**Status:** Live & Functional
**AI Features:** Active (Hybrid: Browser Native + Local Backend)
**Current Date:** 2026-01-04
**Extension Version:** 1.0 (Manifest V3)

---

## 1. Technological Stack

We have evolved the architecture to a **hybrid-intelligence** system. This maximizes performance using browser capabilities while ensuring robust fallback availability.

*   **Frontend (Dashboard):** Next.js 16 (React) + Tailwind CSS (Premium "Deep Zinc" Theme) + Framer Motion.
*   **Browser Extension:** Chrome Manifest V3 with **Offscreen Documents** for background execution.
*   **AI Engine:** 
    *   **Primary:** Chrome `window.ai` (Gemini Nano) for instant, offline, privacy-first processing.
    *   **Secondary:** Local Node.js Backend using `Transformers.js` (`LaMini-Flan-T5`) for reliable fallback.
*   **Backend / Database:** Supabase (PostgreSQL) for storage and syncing.
*   **API Interface:** Supabase REST API via `fetch` standard.

---

## 2. Database Schema (PostgreSQL)

The database remains the central sync point for the extension and dashboard.

### Table: `alerts`

| Column | Type | Description |
| :--- | :--- | :--- |
| `id` | `uuid` | Primary Key |
| `user_email` | `text` | Identity (supports anonymous/public for MVP). |
| `title` | `text` | Title generated by AI or page title. |
| `content` | `text` | **The AI-generated output** (Summary points or Quiz questions). |
| `source_url` | `text` | Origin of the capture. |
| `format` | `text` | 'summary' or 'quiz' (Determines dashboard rendering). |
| `reminder_date` | `date` | Scheduled date (Defaults to `Tomorrow`). |
| `status` | `text` | 'scheduled' |

---

## 3. Core Workflows

### A. The "Smart Capture" Workflow (Extension)
**Goal:** Seamless, user-controlled knowledge capture.
1.  **Trigger:** User right-clicks text -> Selects **"Add Reminder: [Text]"**.
2.  **Interaction:** The **HighlightAgent Popup** opens immediately with pre-filled content.
3.  **Refinement:**
    *   User selects **"Summary"** or **"Quiz"**.
    *   **Dynamic Quiz:** The system calculates the ideal question count (3-10) based on text length.
4.  **Backend Process:**
    *   The extension attempts to use `window.ai`.
    *   If unavailable, it transparently requests the Local Backend (`localhost:8080`) to process the text.
5.  **Storage:** The final formatted content is saved to Supabase.
6.  **Feedback:** The popup closes instantly upon save ("Fire and Forget"), and a **Toast Notification** confirms success on the page.

### B. The Premium Dashboard
**Goal:** Beautiful consumption of captured knowledge.
1.  **No Login Gate:** The dashboard defaults to an "Admin" view, fetching **all** records from Supabase for instant visibility.
2.  **Visualization:**
    *   **List View:** Cards with "Summary" and "Quiz" badges.
    *   **Detail Modal:** A glassmorphic modal overlay.
        *   **Smart Rendering:**
            *   *Summaries* are parsed into clean bullet lists.
            *   *Quizzes* are parsed into structured "Question / Option / Answer" blocks.
3.  **Styling:**
    *   **Theme:** "Deep Zinc" (Dark Mode) with Violet Accents.
    *   **Tech:** Tailwind CSS + Custom Scrollbars.

---

## 4. Connection Details

*   **Supabase URL:** `https://ztwcpkaunjtaftvdirqd.supabase.co`
*   **Key:** (Configured in project source)

---

## 5. Recent Achievements
*   **Premium UI Overhaul:** Re-designed the extension popup with a high-fidelity "HighlightAgent" dark theme, featuring glassmorphism, smooth animations, and optimized typography (Inter).
*   **Dynamic AI Logic:** Implemented smart question counting (approx 1 question per 500 chars) for quizzes, scaling from 3 to 10 questions automatically.
*   **Context Menu Fix:** Resolved issues with nested menus by enforcing a strict cleanup routine, ensuring the "Add Reminder" option is always top-level and accessible.
*   **Hybrid AI Strategy:** Successfully implemented the fallback mechanism from `window.ai` to the local backend, ensuring 100% reliability.

## 6. Next Steps
*   **Email Notifications:** Implement the backend cron job to read `due` alerts and email them to the user.
*   **Multi-User Auth:** Re-enable the login gate when ready for public multi-tenant deployment.
